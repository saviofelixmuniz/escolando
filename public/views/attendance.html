<div class="pagebody">
    <navbar></navbar>

    <div class="container">
        <div class="chart-title">
            <div class="ng-scope">
                <h1 class="d-inline">Frequência</h1>
            </div>
        </div>

        <div>
            <toaster-container toaster-options="{'time-out': 3000, 'close-button':true}"></toaster-container>
        </div>

        <!-- TEACHER VIEW -->
        <div class="mt-3" ng-show="user.role==='teacher'">

          <div class="col-md-10" style="float: right;">
              <label for="group">Turma</label>
              <select id="group" ng-model="group" class="form-control">
                  <option value="" selected disabled ng-if="student.course">Selecione uma turma</option>
                  <option ng-repeat="group in groups" ng-value="group._id" >{{group.name}}</option>
              </select>
          </div>

          <table class="table" style="border-spacing: 20px 0;" ng-show="group" ng-value="group._id">
                <thead>
                <tr>
                    <th scope="col">Nome</th>
                    <th scope="col">Presença</th>
                </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="student in students track by $index">
                        <td>{{student.name}}</td>
                        <td>
                            <label class="switch">
                              <input type="checkbox">
                              <span class="slider round"></span>
                            </label>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div ng-show="group" class="form-group col-md-6">
                <button type="button" class="btn btn-primary" ng-click="registerAttendance()">Registrar presença</button>
                <button type="button" class="btn btn-second mark-all" ng-click="markAll()">Marcar todas</button>
            </div>

           <script type="text/javascript">
              $(document).ready(function(){
                $('.mark-all').on('click', function(){
                  $('.switch').click();
                });
              });
            </script>

        </div>

        <!-- PARENT AND STUDENT VIEW -->
        <div class="mt-3" ng-show="user.role==='parent' || user.role==='student'">

           <div class="absence"> <b>Total de faltas: {{ getAbsenceCount() }} </b></div>

           <h1 class="title text-center"> {{ getMonthYear() }}  </h1>
            <div class="calendar" data-toggle="calendar">
              <div class="row">
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-01">01</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-02">02</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-03">03</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-04">04</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-06">05</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-06">06</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-07">07</time>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-08">08</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-09">09</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-10">10</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-11">11</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-12">12</time>
                  <span class="absence-mark">F<span>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-13">13</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-14">14</time>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-15">15</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-16">16</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-17">17</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-18">18</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-19">19</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-20">20</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-21">21</time>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-22">22</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-23">23</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-24">24</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-25">25</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-26">26</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-27">27</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-28">28</time>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-29">29</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-30">30</time>
                </div>
                <div class="col-xs-12 calendar-day">
                  <time datetime="2018-07-31">31</time>
                </div>
                <div class="col-xs-12 calendar-day  calendar-no-current-month">
                  <time datetime="2018-08-01">01</time>
                </div>
                <div class="col-xs-12 calendar-day  calendar-no-current-month">
                  <time datetime="2018-08-02">02</time>
                </div>
                <div class="col-xs-12 calendar-day calendar-no-current-month">
                  <time datetime="2018-08-03">03</time>
                </div>
                <div class="col-xs-12 calendar-day calendar-no-current-month">
                  <time datetime="2018-08-04">04</time>
                </div>
              </div>
            </div>

            <script type="text/javascript">
              $(function () {
                $('[data-toggle="calendar"] > .row > .calendar-day > .events > .event').popover({
                  container: 'body',
                  content: 'Hello World',
                  html: true,
                  placement: 'bottom',
                  template: '<div class="popover calendar-event-popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'
                });

                $('[data-toggle="calendar"] > .row > .calendar-day > .events > .event').on('show.bs.popover', function () {
                  var attending = parseInt($(this).find('div.progress>.progress-bar').attr('aria-valuenow')),
                    total = parseInt($(this).find('div.progress>.progress-bar').attr('aria-valuemax')),
                    remaining = total - attending,
                    displayAttending = attending - $(this).find('div.attending').children().length,
                    html = [
                      '<button type="button" class="close"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>',
                      '<h4>'+$(this).find('h4').text()+'</h4>',
                      '<div class="desc">'+$(this).find('div.desc').html()+'</div>',
                      '<div class="location">'+$(this).find('div.location').html()+'</div>',
                      '<div class="datetime">'+$(this).find('div.datetime').html()+'</div>',
                      '<div class="space">Attending <span class="pull-right">Available spots</span></div>',
                      '<div class="attending">',
                        $(this).find('div.attending').html(),
                        '<span class="attending-overflow">+'+displayAttending+'</span>', 
                        '<span class="pull-right">'+remaining+'</span>',
                      '</div>',
                      '<a href="#signup" class="btn btn-success" role="button">Sign up</a>'
                    ].join('\n');

                  $(this).attr('title', $(this).find('h4').text());
                  $(this).attr('data-content', html);
                });

                $('[data-toggle="calendar"] > .row > .calendar-day > .events > .event').on('shown.bs.popover', function () {
                  var $popup = $(this);
                  $('.popover:last-child').find('.close').on('click', function(event) {
                    $popup.popover('hide');
                  });
                });
              });
            </script>

        </div>

    </div>
</div>